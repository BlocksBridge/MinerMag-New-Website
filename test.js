let data = {"results":[{"start_date":"2023-10-01","end_date":"2024-09-30","timeframe":"ttm","fiscal_period":"TTM","fiscal_year":"","cik":"0001507605","sic":"6794","tickers":["MARA"],"company_name":"Marathon Patent Group, Inc.","financials":{"cash_flow_statement":{"net_cash_flow_continuing":{"value":7.5046e+07,"unit":"USD","label":"Net Cash Flow, Continuing","order":1200},"net_cash_flow_from_operating_activities":{"value":-4.5476e+08,"unit":"USD","label":"Net Cash Flow From Operating Activities","order":100},"net_cash_flow_from_financing_activities_continuing":{"value":1.757093e+09,"unit":"USD","label":"Net Cash Flow From Financing Activities, Continuing","order":800},"net_cash_flow_from_operating_activities_continuing":{"value":-4.5476e+08,"unit":"USD","label":"Net Cash Flow From Operating Activities, Continuing","order":200},"net_cash_flow_from_investing_activities_continuing":{"value":-1.227287e+09,"unit":"USD","label":"Net Cash Flow From Investing Activities, Continuing","order":500},"net_cash_flow_from_investing_activities":{"value":-1.227287e+09,"unit":"USD","label":"Net Cash Flow From Investing Activities","order":400},"net_cash_flow":{"value":7.5046e+07,"unit":"USD","label":"Net Cash Flow","order":1100},"net_cash_flow_from_financing_activities":{"value":1.757093e+09,"unit":"USD","label":"Net Cash Flow From Financing Activities","order":700}},"income_statement":{"income_tax_expense_benefit":{"value":-2.6692e+07,"unit":"USD","label":"Income Tax Expense/Benefit","order":2200},"preferred_stock_dividends_and_other_adjustments":{"value":0,"unit":"USD","label":"Preferred Stock Dividends And Other Adjustments","order":3900},"costs_and_expenses":{"value":4.60893e+08,"unit":"USD","label":"Costs And Expenses","order":600},"revenues":{"value":5.98752e+08,"unit":"USD","label":"Revenues","order":100},"operating_expenses":{"value":-2.46027e+08,"unit":"USD","label":"Operating Expenses","order":1000},"net_income_loss":{"value":1.64551e+08,"unit":"USD","label":"Net Income/Loss","order":3200},"benefits_costs_expenses":{"value":4.60893e+08,"unit":"USD","label":"Benefits Costs and Expenses","order":200},"income_loss_from_continuing_operations_before_tax":{"value":1.37859e+08,"unit":"USD","label":"Income/Loss From Continuing Operations Before Tax","order":1500},"diluted_earnings_per_share":{"value":0.8400000000000001,"unit":"USD / shares","label":"Diluted Earnings Per Share","order":4300},"net_income_loss_available_to_common_stockholders_basic":{"value":1.64551e+08,"unit":"USD","label":"Net Income/Loss Available To Common Stockholders, Basic","order":3700},"net_income_loss_attributable_to_noncontrolling_interest":{"value":0,"unit":"USD","label":"Net Income/Loss Attributable To Noncontrolling Interest","order":3300},"participating_securities_distributed_and_undistributed_earnings_loss_basic":{"value":0,"unit":"USD","label":"Participating Securities, Distributed And Undistributed Earnings/Loss, Basic","order":3800},"diluted_average_shares":{"value":3.00551203e+08,"unit":"shares","label":"Diluted Average Shares","order":4500},"basic_average_shares":{"value":2.92336415e+08,"unit":"shares","label":"Basic Average Shares","order":4400},"net_income_loss_attributable_to_parent":{"value":1.64551e+08,"unit":"USD","label":"Net Income/Loss Attributable To Parent","order":3500},"basic_earnings_per_share":{"value":0.83,"unit":"USD / shares","label":"Basic Earnings Per Share","order":4200},"income_loss_from_continuing_operations_after_tax":{"value":1.64551e+08,"unit":"USD","label":"Income/Loss From Continuing Operations After Tax","order":1400},"income_loss_before_equity_method_investments":{"value":1.38654e+08,"unit":"USD","label":"Income/Loss Before Equity Method Investments","order":1300},"cost_of_revenue":{"value":6.94632e+08,"unit":"USD","label":"Cost Of Revenue","order":300},"depreciation_and_amortization":{"value":3.37896e+08,"unit":"USD","label":"Depreciation and Amortization","order":1020},"income_loss_from_equity_method_investments":{"value":-795000,"unit":"USD","label":"Income/Loss From Equity Method Investments","order":2100},"operating_income_loss":{"value":1.50147e+08,"unit":"USD","label":"Operating Income/Loss","order":1100},"gross_profit":{"value":-9.588e+07,"unit":"USD","label":"Gross Profit","order":800}},"comprehensive_income":{"comprehensive_income_loss":{"value":1.64551e+08,"unit":"USD","label":"Comprehensive Income/Loss","order":100},"comprehensive_income_loss_attributable_to_noncontrolling_interest":{"value":0,"unit":"USD","label":"Comprehensive Income/Loss Attributable To Noncontrolling Interest","order":200},"other_comprehensive_income_loss":{"value":0,"unit":"USD","label":"Other Comprehensive Income/Loss","order":400},"comprehensive_income_loss_attributable_to_parent":{"value":1.64551e+08,"unit":"USD","label":"Comprehensive Income/Loss Attributable To Parent","order":300}},"balance_sheet":{"noncurrent_prepaid_expenses":{"value":1.9616e+07,"unit":"USD","label":"Non-current Prepaid Expenses","order":340},"current_liabilities":{"value":5.9789e+07,"unit":"USD","label":"Current Liabilities","order":700},"accounts_payable":{"value":1.2561e+07,"unit":"USD","label":"Accounts Payable","order":710},"other_current_liabilities":{"value":4.7228e+07,"unit":"USD","label":"Other Current Liabilities","order":740},"equity_attributable_to_noncontrolling_interest":{"value":0,"unit":"USD","label":"Equity Attributable To Noncontrolling Interest","order":1500},"other_noncurrent_assets":{"value":2.227046e+09,"unit":"USD","label":"Other Non-current Assets","order":350},"equity_attributable_to_parent":{"value":2.855593e+09,"unit":"USD","label":"Equity Attributable To Parent","order":1600},"current_assets":{"value":2.39372e+08,"unit":"USD","label":"Current Assets","order":200},"other_noncurrent_liabilities":{"value":4.6084e+07,"unit":"USD","label":"Other Non-current Liabilities","order":820},"liabilities_and_equity":{"value":3.580149e+09,"unit":"USD","label":"Liabilities And Equity","order":1900},"noncurrent_liabilities":{"value":6.64767e+08,"unit":"USD","label":"Noncurrent Liabilities","order":800},"equity":{"value":2.855593e+09,"unit":"USD","label":"Equity","order":1400},"long_term_debt":{"value":6.18683e+08,"unit":"USD","label":"Long-term Debt","order":810},"liabilities":{"value":7.24556e+08,"unit":"USD","label":"Liabilities","order":600},"noncurrent_assets":{"value":3.340777e+09,"unit":"USD","label":"Noncurrent Assets","order":300},"fixed_assets":{"value":1.09214e+09,"unit":"USD","label":"Fixed Assets","order":320},"accounts_receivable":{"value":2.792e+06,"unit":"USD","label":"Accounts Receivable","order":220},"other_current_assets":{"value":2.3658e+08,"unit":"USD","label":"Other Current Assets","order":250},"assets":{"value":3.580149e+09,"unit":"USD","label":"Assets","order":100},"intangible_assets":{"value":1.975e+06,"unit":"USD","label":"Intangible Assets","order":330}}}}],"status":"OK","request_id":"b0dcc9ef94d8e0c7e5abaf60d665d0f5","next_url":"https://api.polygon.io/vX/reference/financials?cursor=YXA9MDAwMTUwNzYwNSUzQVRUTSZhcz0mbGltaXQ9MSZwZXJpb2Rfb2ZfcmVwb3J0X2RhdGUubHRlPTIwMjQtMDktMzAmc29ydD1wZXJpb2Rfb2ZfcmVwb3J0X2RhdGUmdGlja2VyPU1BUkE"}
let marketD = {
    "request_id": "0bb685d9ca8fa329d0668494cb20ba7e",
    "results": {
        "ticker": "MARA",
        "name": "MARA Holdings, Inc. Common Stock",
        "market": "stocks",
        "locale": "us",
        "primary_exchange": "XNAS",
        "type": "CS",
        "active": true,
        "currency_name": "usd",
        "cik": "0001507605",
        "composite_figi": "BBG001K7WBT8",
        "share_class_figi": "BBG001V0L7T2",
        "market_cap": 5384468463.27,
        "phone_number": "(800) 804-1690",
        "address": {
            "address1": "1180 N. TOWN CENTER DRIVE",
            "address2": "SUITE 100",
            "city": "LAS VEGAS",
            "state": "NV",
            "postal_code": "89144"
        },
        "description": "MARA Holdings Inc leverages digital asset compute to support the energy transformation. It secures the blockchain ledger and supports the energy transformation by converting clean, stranded, or underutilized energy into economic value.",
        "sic_code": "6199",
        "sic_description": "FINANCE SERVICES",
        "ticker_root": "MARA",
        "homepage_url": "http://www.mara.com",
        "total_employees": 109,
        "list_date": "2011-03-09",
        "branding": {
            "logo_url": "https://api.polygon.io/v1/reference/company-branding/bWFyYS5jb20/images/2024-10-01_logo.svg",
            "icon_url": "https://api.polygon.io/v1/reference/company-branding/bWFyYS5jb20/images/2024-10-01_icon.jpeg"
        },
        "share_class_shares_outstanding": 321830000,
        "weighted_shares_outstanding": 294474622,
        "round_lot": 100
    },
    "status": "OK"
}
console.log(data)

function getKeyMetrics(financialJson, companyJson) {
    try {
        const financialData = financialJson.results[0];
        const balanceSheet = financialData.financials.balance_sheet;
        const incomeStatement = financialData.financials.income_statement;
        
        // Calculate debt-to-equity ratio
        const debtToEquityRatio = balanceSheet.long_term_debt.value / balanceSheet.equity.value;

        return {
            marketCap: `${(companyJson.results.market_cap / 1e6).toFixed(2)}M USD`,
            averageVolume: `${(companyJson.results.weighted_shares_outstanding / 1e6).toFixed(2)}M`,
            weekHigh52: "Not available in JSON data",
            weekLow52: "Not available in JSON data",
            debtToEquityRatio: `${(debtToEquityRatio * 100).toFixed(2)}%`,
            basicEPS: `${incomeStatement.basic_earnings_per_share.value} USD/share`,
            revenue: `${(incomeStatement.revenues.value / 1e6).toFixed(2)}M USD`,
            netIncome: `${(incomeStatement.net_income_loss.value / 1e6).toFixed(2)}M USD`,
            sharesFloat: `${(companyJson.results.share_class_shares_outstanding / 1e6).toFixed(2)}M`,
            totalEmployees: companyJson.results.total_employees
        };
    } catch (error) {
        return {
            error: "Error getting key metrics",
            details: error.message
        };
    }
}
d = getKeyMetrics(data, marketD)
console.log(d)
// Example usage:
/*
const metrics = getKeyMetrics(financialJson, companyJson);
console.log(metrics);
*/
// const result = analyzeFinancialData(data);
// console.log(data.results[0], marketD);

// Example usage:
/* 
const result = analyzeFinancialData(jsonData);
console.log(result);

Output will be something like:
{
    marketStats: {
        marketCap: "741.83M USD",
        avgVolume: "33.72M",
        beta: "2.21",
        sharesFloat: "381.83M"
    },
    fundamentals: {
        eps: "-0.34 USD",
        revenue: "598.75M USD",
        netIncome: "164.55M USD",
        debtToEquityRatio: "21.67%"
    },
    balanceSheet: {
        totalDebt: "618.68M USD",
        totalEquity: "2.86B USD",
        totalAssets: "3.58B USD",
        totalLiabilities: "724.56M USD"
    }
}
*/